<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A Calculus for Language Models - Mathematical framework for compositional language modeling"><meta name=author content="LangCalc Team"><link href=https://github.com/queelius/langcalc/projection-system/ordering/ rel=canonical><link href=../augmentations/ rel=prev><link href=../implementation/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.21"><title>Ordering Principles - LangCalc Documentation</title><link rel=stylesheet href=../../assets/stylesheets/main.2a3383ac.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1%207.775V2.75C1%201.784%201.784%201%202.75%201h5.025c.464%200%20.91.184%201.238.513l6.25%206.25a1.75%201.75%200%200%201%200%202.474l-5.026%205.026a1.75%201.75%200%200%201-2.474%200l-6.25-6.25A1.75%201.75%200%200%201%201%207.775m1.5%200c0%20.066.026.13.073.177l6.25%206.25a.25.25%200%200%200%20.354%200l5.025-5.025a.25.25%200%200%200%200-.354l-6.25-6.25a.25.25%200%200%200-.177-.073H2.75a.25.25%200%200%200-.25.25ZM6%205a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.5%201.75v11.5c0%20.138.112.25.25.25h3.17a.75.75%200%200%201%200%201.5H2.75A1.75%201.75%200%200%201%201%2013.25V1.75C1%20.784%201.784%200%202.75%200h8.5C12.216%200%2013%20.784%2013%201.75v7.736a.75.75%200%200%201-1.5%200V1.75a.25.25%200%200%200-.25-.25h-8.5a.25.25%200%200%200-.25.25m13.274%209.537zl-4.557%204.45a.75.75%200%200%201-1.055-.008l-1.943-1.95a.75.75%200%200%201%201.062-1.058l1.419%201.425%204.026-3.932a.75.75%200%201%201%201.048%201.074M4.75%204h4.5a.75.75%200%200%201%200%201.5h-4.5a.75.75%200%200%201%200-1.5M4%207.75A.75.75%200%200%201%204.75%207h2a.75.75%200%200%201%200%201.5h-2A.75.75%200%200%201%204%207.75%22/%3E%3C/svg%3E');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.5%207.75A.75.75%200%200%201%207.25%207h1a.75.75%200%200%201%20.75.75v2.75h.25a.75.75%200%200%201%200%201.5h-2a.75.75%200%200%201%200-1.5h.25v-2h-.25a.75.75%200%200%201-.75-.75M8%206a1%201%200%201%201%200-2%201%201%200%200%201%200%202%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M3.499.75a.75.75%200%200%201%201.5%200v.996C5.9%202.903%206.793%203.65%207.662%204.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873%2010.794-.045%2012.622.26%2014.408.558%2016%201.94%2016%204.25c0%201.278-.954%202.575-2.44%202.734l.146.508.065.22c.203.701.412%201.455.476%202.226.142%201.707-.4%203.03-1.487%203.898C11.714%2014.671%2010.27%2015%208.75%2015h-6a.75.75%200%200%201%200-1.5h1.376a4.5%204.5%200%200%201-.563-1.191%203.84%203.84%200%200%201-.05-2.063%204.65%204.65%200%200%201-2.025-.293.75.75%200%200%201%20.525-1.406c1.357.507%202.376-.006%202.698-.318l.009-.01a.747.747%200%200%201%201.06%200%20.75.75%200%200%201-.012%201.074c-.912.92-.992%201.835-.768%202.586.221.74.745%201.337%201.196%201.621H8.75c1.343%200%202.398-.296%203.074-.836.635-.507%201.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.4%202.4%200%200%201-.507-.441%203.1%203.1%200%200%201-.633-1.248.75.75%200%200%201%201.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738%200%201.25-.615%201.25-1.25%200-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706%201.345-.46.92-.27%201.774.019%203.062l.042.19.01.05c.348.443.666.949.94%201.553a.75.75%200%201%201-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7%205.527c-.814-.68-1.75-1.462-2.692-2.619a3.7%203.7%200%200%200-1.023.88c-.406.495-.663%201.036-.722%201.508.116.122.306.21.591.239.388.038.797-.06%201.032-.19a.75.75%200%200%201%20.728%201.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75%205.677V5.5c0-.984.48-1.94%201.077-2.664.46-.559%201.05-1.055%201.673-1.353z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M13.78%204.22a.75.75%200%200%201%200%201.06l-7.25%207.25a.75.75%200%200%201-1.06%200L2.22%209.28a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018L6%2010.94l6.72-6.72a.75.75%200%200%201%201.06%200%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M0%208a8%208%200%201%201%2016%200A8%208%200%200%201%200%208m8-6.5a6.5%206.5%200%201%200%200%2013%206.5%206.5%200%200%200%200-13M6.92%206.085h.001a.749.749%200%201%201-1.342-.67c.169-.339.436-.701.849-.977C6.845%204.16%207.369%204%208%204a2.76%202.76%200%200%201%201.637.525c.503.377.863.965.863%201.725%200%20.448-.115.83-.329%201.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6%206%200%200%200-.26.16%201%201%200%200%200-.276.245.75.75%200%200%201-1.248-.832c.184-.264.42-.489.692-.661q.154-.1.313-.195l.007-.004c.1-.061.182-.11.258-.161a1%201%200%200%200%20.277-.245C8.96%206.514%209%206.427%209%206.25a.61.61%200%200%200-.262-.525A1.27%201.27%200%200%200%208%205.5c-.369%200-.595.09-.74.187a1%201%200%200%200-.34.398M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M6.457%201.047c.659-1.234%202.427-1.234%203.086%200l6.082%2011.378A1.75%201.75%200%200%201%2014.082%2015H1.918a1.75%201.75%200%200%201-1.543-2.575Zm1.763.707a.25.25%200%200%200-.44%200L1.698%2013.132a.25.25%200%200%200%20.22.368h12.164a.25.25%200%200%200%20.22-.368Zm.53%203.996v2.5a.75.75%200%200%201-1.5%200v-2.5a.75.75%200%200%201%201.5%200M9%2011a1%201%200%201%201-2%200%201%201%200%200%201%202%200%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2.344%202.343za8%208%200%200%201%2011.314%2011.314A8.002%208.002%200%200%201%20.234%2010.089a8%208%200%200%201%202.11-7.746m1.06%2010.253a6.5%206.5%200%201%200%209.108-9.275%206.5%206.5%200%200%200-9.108%209.275M6.03%204.97%208%206.94l1.97-1.97a.749.749%200%200%201%201.275.326.75.75%200%200%201-.215.734L9.06%208l1.97%201.97a.749.749%200%200%201-.326%201.275.75.75%200%200%201-.734-.215L8%209.06l-1.97%201.97a.749.749%200%200%201-1.275-.326.75.75%200%200%201%20.215-.734L6.94%208%204.97%206.03a.75.75%200%200%201%20.018-1.042.75.75%200%200%201%201.042-.018%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M9.504.43a1.516%201.516%200%200%201%202.437%201.713L10.415%205.5h2.123c1.57%200%202.346%201.909%201.22%203.004l-7.34%207.142a1.25%201.25%200%200%201-.871.354h-.302a1.25%201.25%200%200%201-1.157-1.723L5.633%2010.5H3.462c-1.57%200-2.346-1.909-1.22-3.004zm1.047%201.074L3.286%208.571A.25.25%200%200%200%203.462%209H6.75a.75.75%200%200%201%20.694%201.034l-1.713%204.188%206.982-6.793A.25.25%200%200%200%2012.538%207H9.25a.75.75%200%200%201-.683-1.06l2.008-4.418.003-.006-.004-.009-.006-.006-.008-.001q-.005%200-.009.004%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M4.72.22a.75.75%200%200%201%201.06%200l1%20.999a3.5%203.5%200%200%201%202.441%200l.999-1a.748.748%200%200%201%201.265.332.75.75%200%200%201-.205.729l-.775.776c.616.63.995%201.493.995%202.444v.327q0%20.15-.025.292c.408.14.764.392%201.029.722l1.968-.787a.75.75%200%200%201%20.556%201.392L13%207.258V9h2.25a.75.75%200%200%201%200%201.5H13v.5q-.002.615-.141%201.186l2.17.868a.75.75%200%200%201-.557%201.392l-2.184-.873A5%205%200%200%201%208%2016a5%205%200%200%201-4.288-2.427l-2.183.873a.75.75%200%200%201-.558-1.392l2.17-.868A5%205%200%200%201%203%2011v-.5H.75a.75.75%200%200%201%200-1.5H3V7.258L.971%206.446a.75.75%200%200%201%20.558-1.392l1.967.787c.265-.33.62-.583%201.03-.722a1.7%201.7%200%200%201-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72%201.28a.75.75%200%200%201%200-1.06m.53%206.28a.75.75%200%200%200-.75.75V11a3.5%203.5%200%201%200%207%200V7.25a.75.75%200%200%200-.75-.75ZM6.173%205h3.654A.17.17%200%200%200%2010%204.827V4.5a2%202%200%201%200-4%200v.327c0%20.096.077.173.173.173%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5%205.782V2.5h-.25a.75.75%200%200%201%200-1.5h6.5a.75.75%200%200%201%200%201.5H11v3.282l3.666%205.76C15.619%2013.04%2014.543%2015%2012.767%2015H3.233c-1.776%200-2.852-1.96-1.899-3.458Zm-2.4%206.565a.75.75%200%200%200%20.633%201.153h9.534a.75.75%200%200%200%20.633-1.153L12.225%2010.5h-8.45ZM9.5%202.5h-3V6c0%20.143-.04.283-.117.403L4.73%209h6.54L9.617%206.403A.75.75%200%200%201%209.5%206Z%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M1.75%202.5h10.5a.75.75%200%200%201%200%201.5H1.75a.75.75%200%200%201%200-1.5m4%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5m0%205h8.5a.75.75%200%200%201%200%201.5h-8.5a.75.75%200%200%201%200-1.5M2.5%207.75v6a.75.75%200%200%201-1.5%200v-6a.75.75%200%200%201%201.5%200%22/%3E%3C/svg%3E');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#projection-ordering-and-non-commutativity class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="LangCalc Documentation" class="md-header__button md-logo" aria-label="LangCalc Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> LangCalc Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Ordering Principles </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/queelius/langcalc title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> queelius/langcalc </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../getting-started/ class=md-tabs__link> Getting Started </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../ class=md-tabs__link> Projection System </a> </li> <li class=md-tabs__item> <a href=../../user-guide/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../api/ class=md-tabs__link> API Reference </a> </li> <li class=md-tabs__item> <a href=../../advanced/ class=md-tabs__link> Advanced Topics </a> </li> <li class=md-tabs__item> <a href=../../development/ class=md-tabs__link> Development </a> </li> <li class=md-tabs__item> <a href=../../about/ class=md-tabs__link> About </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="LangCalc Documentation" class="md-nav__button md-logo" aria-label="LangCalc Documentation" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> LangCalc Documentation </label> <div class=md-nav__source> <a href=https://github.com/queelius/langcalc title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> queelius/langcalc </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <div class="md-nav__link md-nav__container"> <a href=../../getting-started/ class="md-nav__link "> <span class=md-ellipsis> Getting Started </span> </a> <label class="md-nav__link " for=__nav_2 id=__nav_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting-started/installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/quickstart/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/concepts/ class=md-nav__link> <span class=md-ellipsis> Core Concepts </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <div class="md-nav__link md-nav__container"> <a href=../ class="md-nav__link "> <span class=md-ellipsis> Projection System </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Projection System </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../formalism/ class=md-nav__link> <span class=md-ellipsis> Mathematical Formalism </span> </a> </li> <li class=md-nav__item> <a href=../augmentations/ class=md-nav__link> <span class=md-ellipsis> Canonical Augmentations </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Ordering Principles </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Ordering Principles </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#abstract class=md-nav__link> <span class=md-ellipsis> Abstract </span> </a> </li> <li class=md-nav__item> <a href=#1-non-commutativity-of-projections class=md-nav__link> <span class=md-ellipsis> 1. Non-Commutativity of Projections </span> </a> <nav class=md-nav aria-label="1. Non-Commutativity of Projections"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-mathematical-statement class=md-nav__link> <span class=md-ellipsis> 1.1 Mathematical Statement </span> </a> </li> <li class=md-nav__item> <a href=#12-algebraic-structure class=md-nav__link> <span class=md-ellipsis> 1.2 Algebraic Structure </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-when-order-matters class=md-nav__link> <span class=md-ellipsis> 2. When Order Matters </span> </a> <nav class=md-nav aria-label="2. When Order Matters"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-dependency-analysis class=md-nav__link> <span class=md-ellipsis> 2.1 Dependency Analysis </span> </a> </li> <li class=md-nav__item> <a href=#22-classes-of-dependencies class=md-nav__link> <span class=md-ellipsis> 2.2 Classes of Dependencies </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-canonical-ordering-principles class=md-nav__link> <span class=md-ellipsis> 3. Canonical Ordering Principles </span> </a> <nav class=md-nav aria-label="3. Canonical Ordering Principles"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-general-pipeline class=md-nav__link> <span class=md-ellipsis> 3.1 General Pipeline </span> </a> </li> <li class=md-nav__item> <a href=#32-formal-ordering-rules class=md-nav__link> <span class=md-ellipsis> 3.2 Formal Ordering Rules </span> </a> </li> <li class=md-nav__item> <a href=#33-example-complete-pipeline class=md-nav__link> <span class=md-ellipsis> 3.3 Example: Complete Pipeline </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-commutativity-classes class=md-nav__link> <span class=md-ellipsis> 4. Commutativity Classes </span> </a> <nav class=md-nav aria-label="4. Commutativity Classes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-identifying-commutative-pairs class=md-nav__link> <span class=md-ellipsis> 4.1 Identifying Commutative Pairs </span> </a> </li> <li class=md-nav__item> <a href=#42-commutative-examples class=md-nav__link> <span class=md-ellipsis> 4.2 Commutative Examples </span> </a> </li> <li class=md-nav__item> <a href=#43-non-commutative-examples class=md-nav__link> <span class=md-ellipsis> 4.3 Non-Commutative Examples </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-practical-guidelines class=md-nav__link> <span class=md-ellipsis> 5. Practical Guidelines </span> </a> <nav class=md-nav aria-label="5. Practical Guidelines"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-decision-tree-for-ordering class=md-nav__link> <span class=md-ellipsis> 5.1 Decision Tree for Ordering </span> </a> </li> <li class=md-nav__item> <a href=#52-testing-for-commutativity class=md-nav__link> <span class=md-ellipsis> 5.2 Testing for Commutativity </span> </a> </li> <li class=md-nav__item> <a href=#53-documenting-ordering-constraints class=md-nav__link> <span class=md-ellipsis> 5.3 Documenting Ordering Constraints </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6-advanced-multi-path-projections class=md-nav__link> <span class=md-ellipsis> 6. Advanced: Multi-Path Projections </span> </a> <nav class=md-nav aria-label="6. Advanced: Multi-Path Projections"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#61-exploring-multiple-orders class=md-nav__link> <span class=md-ellipsis> 6.1 Exploring Multiple Orders </span> </a> </li> <li class=md-nav__item> <a href=#62-learned-ordering class=md-nav__link> <span class=md-ellipsis> 6.2 Learned Ordering </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-implications-for-api-design class=md-nav__link> <span class=md-ellipsis> 7. Implications for API Design </span> </a> <nav class=md-nav aria-label="7. Implications for API Design"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#71-left-to-right-composition class=md-nav__link> <span class=md-ellipsis> 7.1 Left-to-Right Composition </span> </a> </li> <li class=md-nav__item> <a href=#72-named-pipelines class=md-nav__link> <span class=md-ellipsis> 7.2 Named Pipelines </span> </a> </li> <li class=md-nav__item> <a href=#73-validation class=md-nav__link> <span class=md-ellipsis> 7.3 Validation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#8-mathematical-properties class=md-nav__link> <span class=md-ellipsis> 8. Mathematical Properties </span> </a> <nav class=md-nav aria-label="8. Mathematical Properties"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#81-associativity-preserved class=md-nav__link> <span class=md-ellipsis> 8.1 Associativity (Preserved) </span> </a> </li> <li class=md-nav__item> <a href=#82-identity-preservation class=md-nav__link> <span class=md-ellipsis> 8.2 Identity Preservation </span> </a> </li> <li class=md-nav__item> <a href=#83-partial-ordering class=md-nav__link> <span class=md-ellipsis> 8.3 Partial Ordering </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#9-case-studies class=md-nav__link> <span class=md-ellipsis> 9. Case Studies </span> </a> <nav class=md-nav aria-label="9. Case Studies"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#91-case-study-query-expansion-for-search class=md-nav__link> <span class=md-ellipsis> 9.1 Case Study: Query Expansion for Search </span> </a> </li> <li class=md-nav__item> <a href=#92-case-study-code-completion class=md-nav__link> <span class=md-ellipsis> 9.2 Case Study: Code Completion </span> </a> </li> <li class=md-nav__item> <a href=#93-case-study-chat-message-matching class=md-nav__link> <span class=md-ellipsis> 9.3 Case Study: Chat Message Matching </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#10-conclusion class=md-nav__link> <span class=md-ellipsis> 10. Conclusion </span> </a> <nav class=md-nav aria-label="10. Conclusion"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#101-key-takeaways class=md-nav__link> <span class=md-ellipsis> 10.1 Key Takeaways </span> </a> </li> <li class=md-nav__item> <a href=#102-default-pipeline-recommendation class=md-nav__link> <span class=md-ellipsis> 10.2 Default Pipeline Recommendation </span> </a> </li> <li class=md-nav__item> <a href=#103-future-work class=md-nav__link> <span class=md-ellipsis> 10.3 Future Work </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../implementation/ class=md-nav__link> <span class=md-ellipsis> Reference Implementation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <div class="md-nav__link md-nav__container"> <a href=../../user-guide/ class="md-nav__link "> <span class=md-ellipsis> User Guide </span> </a> <label class="md-nav__link " for=__nav_4 id=__nav_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/models/ class=md-nav__link> <span class=md-ellipsis> Language Models </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/algebra/ class=md-nav__link> <span class=md-ellipsis> Algebraic Operations </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/transformations/ class=md-nav__link> <span class=md-ellipsis> Context Transformations </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/examples/ class=md-nav__link> <span class=md-ellipsis> Examples & Patterns </span> </a> </li> <li class=md-nav__item> <a href=../../user-guide/best-practices/ class=md-nav__link> <span class=md-ellipsis> Best Practices </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <div class="md-nav__link md-nav__container"> <a href=../../api/ class="md-nav__link "> <span class=md-ellipsis> API Reference </span> </a> <label class="md-nav__link " for=__nav_5 id=__nav_5_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> API Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../api/core/ class=md-nav__link> <span class=md-ellipsis> Core Module </span> </a> </li> <li class=md-nav__item> <a href=../../api/models/ class=md-nav__link> <span class=md-ellipsis> Models </span> </a> </li> <li class=md-nav__item> <a href=../../api/projections/ class=md-nav__link> <span class=md-ellipsis> Projections </span> </a> </li> <li class=md-nav__item> <a href=../../api/augmentations/ class=md-nav__link> <span class=md-ellipsis> Augmentations </span> </a> </li> <li class=md-nav__item> <a href=../../api/algebra/ class=md-nav__link> <span class=md-ellipsis> Algebra </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <div class="md-nav__link md-nav__container"> <a href=../../advanced/ class="md-nav__link "> <span class=md-ellipsis> Advanced Topics </span> </a> <label class="md-nav__link " for=__nav_6 id=__nav_6_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Advanced Topics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../advanced/suffix-arrays/ class=md-nav__link> <span class=md-ellipsis> Suffix Arrays </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/grounding/ class=md-nav__link> <span class=md-ellipsis> Lightweight Grounding </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/performance/ class=md-nav__link> <span class=md-ellipsis> Performance Optimization </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/extending/ class=md-nav__link> <span class=md-ellipsis> Extending LangCalc </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <div class="md-nav__link md-nav__container"> <a href=../../development/ class="md-nav__link "> <span class=md-ellipsis> Development </span> </a> <label class="md-nav__link " for=__nav_7 id=__nav_7_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../development/contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../../development/testing/ class=md-nav__link> <span class=md-ellipsis> Testing </span> </a> </li> <li class=md-nav__item> <a href=../../development/style/ class=md-nav__link> <span class=md-ellipsis> Code Style </span> </a> </li> <li class=md-nav__item> <a href=../../development/releases/ class=md-nav__link> <span class=md-ellipsis> Release Process </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_8> <div class="md-nav__link md-nav__container"> <a href=../../about/ class="md-nav__link "> <span class=md-ellipsis> About </span> </a> <label class="md-nav__link " for=__nav_8 id=__nav_8_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> About </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../about/license/ class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> <li class=md-nav__item> <a href=../../about/changelog/ class=md-nav__link> <span class=md-ellipsis> Changelog </span> </a> </li> <li class=md-nav__item> <a href=../../about/paper/ class=md-nav__link> <span class=md-ellipsis> Academic Paper </span> </a> </li> <li class=md-nav__item> <a href=../../about/citation/ class=md-nav__link> <span class=md-ellipsis> Citation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=projection-ordering-and-non-commutativity>Projection Ordering and Non-Commutativity<a class=headerlink href=#projection-ordering-and-non-commutativity title="Permanent link">&para;</a></h1> <h2 id=abstract>Abstract<a class=headerlink href=#abstract title="Permanent link">&para;</a></h2> <p>While projections form a <strong>monoid</strong> under sequential composition (associative with identity), they are generally <strong>not commutative</strong>. The order in which projections are applied significantly affects the result. This document establishes principles for ordering projections and identifies cases where order matters.</p> <hr> <h2 id=1-non-commutativity-of-projections>1. Non-Commutativity of Projections<a class=headerlink href=#1-non-commutativity-of-projections title="Permanent link">&para;</a></h2> <h3 id=11-mathematical-statement>1.1 Mathematical Statement<a class=headerlink href=#11-mathematical-statement title="Permanent link">&para;</a></h3> <p><strong>Theorem 1.1 (Non-Commutativity):</strong> For projections <span class=arithmatex>\(\pi_1, \pi_2\)</span>: <span class=arithmatex>\(<span class=arithmatex>\(\pi_1 \circ \pi_2 \neq \pi_2 \circ \pi_1 \quad \text{(in general)}\)</span>\)</span></p> <p><strong>Proof by Example:</strong></p> <p>Let: - $\pi_1 = $ SynonymProjection (replaces words with synonyms) - $\pi_2 = $ EditDistanceProjection (finds typo corrections)</p> <p><strong>Case 1:</strong> <span class=arithmatex>\(\pi_1 \circ \pi_2\)</span> (typo correction, then synonym) <div class="language-text highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>Input:    &quot;the quik cat&quot;
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>→ π₂:     &quot;the quick cat&quot;      (fix typo: quik → quick)
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>→ π₁:     &quot;the fast feline&quot;    (synonyms: quick → fast, cat → feline)
</span></code></pre></div></p> <p><strong>Case 2:</strong> <span class=arithmatex>\(\pi_2 \circ \pi_1\)</span> (synonym, then typo correction) <div class="language-text highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>Input:    &quot;the quik cat&quot;
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>→ π₁:     &quot;the quik feline&quot;    (synonym: cat → feline, but &quot;quik&quot; has no synonym)
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>→ π₂:     &quot;the quick feline&quot;   (fix typo: quik → quick)
</span></code></pre></div></p> <p><strong>Result:</strong> Different outputs! Order matters. ∎</p> <h3 id=12-algebraic-structure>1.2 Algebraic Structure<a class=headerlink href=#12-algebraic-structure title="Permanent link">&para;</a></h3> <p>Projections form a <strong>non-commutative monoid</strong>:</p> <ol> <li><strong>Closure:</strong> <span class=arithmatex>\(\pi_1 \circ \pi_2\)</span> is a projection</li> <li><strong>Associativity:</strong> <span class=arithmatex>\((\pi_1 \circ \pi_2) \circ \pi_3 = \pi_1 \circ (\pi_2 \circ \pi_3)\)</span></li> <li><strong>Identity:</strong> <span class=arithmatex>\(\pi_{\text{id}} \circ \pi = \pi \circ \pi_{\text{id}} = \pi\)</span></li> <li><strong>Non-commutativity:</strong> <span class=arithmatex>\(\pi_1 \circ \pi_2 \neq \pi_2 \circ \pi_1\)</span> (generally)</li> </ol> <p>This is similar to function composition, matrix multiplication, or string concatenation.</p> <hr> <h2 id=2-when-order-matters>2. When Order Matters<a class=headerlink href=#2-when-order-matters title="Permanent link">&para;</a></h2> <h3 id=21-dependency-analysis>2.1 Dependency Analysis<a class=headerlink href=#21-dependency-analysis title="Permanent link">&para;</a></h3> <p><strong>Definition 2.1 (Projection Dependency):</strong> Projection <span class=arithmatex>\(\pi_2\)</span> <strong>depends on</strong> <span class=arithmatex>\(\pi_1\)</span> if: <span class=arithmatex>\(<span class=arithmatex>\(\exists x, C: \pi_2(\pi_1(x, C), C) \neq \pi_2(x, C)\)</span>\)</span></p> <p><strong>Interpretation:</strong> <span class=arithmatex>\(\pi_2\)</span>'s behavior changes based on <span class=arithmatex>\(\pi_1\)</span>'s transformation.</p> <h3 id=22-classes-of-dependencies>2.2 Classes of Dependencies<a class=headerlink href=#22-classes-of-dependencies title="Permanent link">&para;</a></h3> <h4 id=class-a-lossy-lossless-order-critical>Class A: Lossy → Lossless (Order Critical)<a class=headerlink href=#class-a-lossy-lossless-order-critical title="Permanent link">&para;</a></h4> <p><strong>Pattern:</strong> Apply lossy projections before lossless ones.</p> <p><strong>Example:</strong> Truncation before normalization <div class="language-python highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># WRONG ORDER: Normalize, then truncate</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=n>projection</span> <span class=o>=</span> <span class=n>RecencyProjection</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span> <span class=o>&gt;&gt;</span> <span class=n>LowercaseProjection</span><span class=p>()</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=c1># Input:  &quot;The Quick Brown Fox Jumps Over&quot;</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=c1># → Truncate: &quot;rown Fox J&quot;  (loses &quot;The Quick B&quot;)</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=c1># → Lowercase: &quot;rown fox j&quot;  (normalized after truncation)</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=c1># RIGHT ORDER: Normalize, then truncate</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=n>projection</span> <span class=o>=</span> <span class=n>LowercaseProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span> <span class=n>RecencyProjection</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=c1># Input:  &quot;The Quick Brown Fox Jumps Over&quot;</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=c1># → Lowercase: &quot;the quick brown fox jumps over&quot;</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=c1># → Truncate: &quot;umps over&quot;  (preserves more normalized context)</span>
</span></code></pre></div></p> <p><strong>Rule:</strong> <strong>Lossy last</strong> - Apply destructive transformations (truncation, sampling) after information-preserving ones (normalization).</p> <h4 id=class-b-correction-transformation-order-critical>Class B: Correction → Transformation (Order Critical)<a class=headerlink href=#class-b-correction-transformation-order-critical title="Permanent link">&para;</a></h4> <p><strong>Pattern:</strong> Fix errors before semantic transformations.</p> <p><strong>Example:</strong> Typo correction before synonym expansion <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1># RIGHT ORDER: Fix typos, then find synonyms</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=n>projection</span> <span class=o>=</span> <span class=n>EditDistanceProjection</span><span class=p>(</span><span class=n>max_distance</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span> <span class=o>&gt;&gt;</span> <span class=n>SynonymProjection</span><span class=p>()</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=c1># Input:  &quot;the quik cat&quot;</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=c1># → Fix typo: &quot;the quick cat&quot;</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=c1># → Synonyms: &quot;the fast feline&quot;</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=c1># WRONG ORDER: Find synonyms, then fix typos</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=n>projection</span> <span class=o>=</span> <span class=n>SynonymProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span> <span class=n>EditDistanceProjection</span><span class=p>(</span><span class=n>max_distance</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=c1># Input:  &quot;the quik cat&quot;</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=c1># → Synonyms: &quot;the quik feline&quot;  (no synonym for misspelled &quot;quik&quot;)</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=c1># → Fix typo: &quot;the quick feline&quot;  (partial correction)</span>
</span></code></pre></div></p> <p><strong>Rule:</strong> <strong>Correct first</strong> - Error correction before semantic transformations.</p> <h4 id=class-c-semantic-structural-order-critical>Class C: Semantic → Structural (Order Critical)<a class=headerlink href=#class-c-semantic-structural-order-critical title="Permanent link">&para;</a></h4> <p><strong>Pattern:</strong> Semantic transformations before structural ones.</p> <p><strong>Example:</strong> Synonym expansion before longest suffix <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1># RIGHT ORDER: Expand synonyms, then find longest match</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=n>projection</span> <span class=o>=</span> <span class=n>SynonymProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span> <span class=n>LongestSuffixProjection</span><span class=p>()</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=c1># Input:  &quot;the cat sat&quot;</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=c1># → Synonyms: &quot;the feline sat&quot;</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=c1># → Longest suffix in corpus: &quot;the feline sat on the mat&quot;  (longer match)</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=c1># WRONG ORDER: Find longest match, then expand synonyms</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=n>projection</span> <span class=o>=</span> <span class=n>LongestSuffixProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span> <span class=n>SynonymProjection</span><span class=p>()</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=c1># Input:  &quot;the cat sat&quot;</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=c1># → Longest suffix: &quot;cat sat&quot;  (shorter match, &quot;cat&quot; not in corpus)</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=c1># → Synonyms: &quot;feline sat&quot;  (too late, already truncated)</span>
</span></code></pre></div></p> <p><strong>Rule:</strong> <strong>Semantic first</strong> - Expand semantic space before structural matching.</p> <h4 id=class-d-independent-transformations-order-irrelevant>Class D: Independent Transformations (Order Irrelevant)<a class=headerlink href=#class-d-independent-transformations-order-irrelevant title="Permanent link">&para;</a></h4> <p><strong>Pattern:</strong> Transformations that don't interact.</p> <p><strong>Example:</strong> Case + Whitespace normalization <div class="language-python highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1># These commute:</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=n>projection1</span> <span class=o>=</span> <span class=n>LowercaseProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span> <span class=n>WhitespaceProjection</span><span class=p>()</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=n>projection2</span> <span class=o>=</span> <span class=n>WhitespaceProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span> <span class=n>LowercaseProjection</span><span class=p>()</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=c1># Input:  &quot;Hello  World&quot;</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=c1># Both produce: &quot;hello world&quot;</span>
</span></code></pre></div></p> <p><strong>Rule:</strong> <strong>Independent commute</strong> - If transformations don't interact, order doesn't matter.</p> <hr> <h2 id=3-canonical-ordering-principles>3. Canonical Ordering Principles<a class=headerlink href=#3-canonical-ordering-principles title="Permanent link">&para;</a></h2> <h3 id=31-general-pipeline>3.1 General Pipeline<a class=headerlink href=#31-general-pipeline title="Permanent link">&para;</a></h3> <p><strong>Recommended Order:</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>1. Error Correction (typos, encoding issues)
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>   ↓
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>2. Normalization (case, whitespace, Unicode)
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>   ↓
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>3. Semantic Expansion (synonyms, stemming, lemmatization)
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>   ↓
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>4. Structural Matching (longest suffix, edit distance on structure)
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>   ↓
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>5. Lossy Operations (truncation, sampling)
</span></code></pre></div></p> <p><strong>Rationale:</strong> 1. Fix errors early (clean data) 2. Normalize to canonical form (consistent representation) 3. Expand semantic space (increase match potential) 4. Find structural patterns (leverage expanded space) 5. Reduce context if needed (preserve only relevant info)</p> <h3 id=32-formal-ordering-rules>3.2 Formal Ordering Rules<a class=headerlink href=#32-formal-ordering-rules title="Permanent link">&para;</a></h3> <p><strong>Rule 1 (Error Before Transformation):</strong> <span class=arithmatex>\(<span class=arithmatex>\(\pi_{\text{error}} \gg \pi_{\text{transform}}\)</span>\)</span></p> <p><strong>Rule 2 (Normalization Before Expansion):</strong> <span class=arithmatex>\(<span class=arithmatex>\(\pi_{\text{normalize}} \gg \pi_{\text{expand}}\)</span>\)</span></p> <p><strong>Rule 3 (Expansion Before Matching):</strong> <span class=arithmatex>\(<span class=arithmatex>\(\pi_{\text{expand}} \gg \pi_{\text{match}}\)</span>\)</span></p> <p><strong>Rule 4 (Lossy Last):</strong> <span class=arithmatex>\(<span class=arithmatex>\(\pi_{\text{preserving}} \gg \pi_{\text{lossy}}\)</span>\)</span></p> <h3 id=33-example-complete-pipeline>3.3 Example: Complete Pipeline<a class=headerlink href=#33-example-complete-pipeline title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=n>projection</span> <span class=o>=</span> <span class=p>(</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>    <span class=c1># 1. Error correction</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>    <span class=n>EditDistanceProjection</span><span class=p>(</span><span class=n>max_distance</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>    <span class=c1># 2. Normalization</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>    <span class=n>WhitespaceProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>    <span class=n>LowercaseProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>    <span class=n>UnicodeNormalizationProjection</span><span class=p>(</span><span class=s1>&#39;NFC&#39;</span><span class=p>)</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>    <span class=c1># 3. Semantic expansion</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>    <span class=n>SynonymProjection</span><span class=p>(</span><span class=n>wordnet_synsets</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a>    <span class=c1># 4. Structural matching</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a>    <span class=n>LongestSuffixProjection</span><span class=p>(</span><span class=n>min_length</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a>    <span class=c1># 5. Lossy operations</span>
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a>    <span class=n>RecencyProjection</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
</span><span id=__span-7-18><a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a><span class=p>)</span>
</span></code></pre></div> <hr> <h2 id=4-commutativity-classes>4. Commutativity Classes<a class=headerlink href=#4-commutativity-classes title="Permanent link">&para;</a></h2> <h3 id=41-identifying-commutative-pairs>4.1 Identifying Commutative Pairs<a class=headerlink href=#41-identifying-commutative-pairs title="Permanent link">&para;</a></h3> <p><strong>Definition 4.1 (Commutative Projections):</strong> Projections <span class=arithmatex>\(\pi_1, \pi_2\)</span> commute if: <span class=arithmatex>\(<span class=arithmatex>\(\forall x, C: \pi_1(\pi_2(x, C), C) = \pi_2(\pi_1(x, C), C)\)</span>\)</span></p> <p><strong>Theorem 4.1 (Independent Transformations):</strong> If <span class=arithmatex>\(\pi_1\)</span> and <span class=arithmatex>\(\pi_2\)</span> transform disjoint aspects of the input, they commute.</p> <h3 id=42-commutative-examples>4.2 Commutative Examples<a class=headerlink href=#42-commutative-examples title="Permanent link">&para;</a></h3> <h4 id=lowercase-whitespace>Lowercase + Whitespace<a class=headerlink href=#lowercase-whitespace title="Permanent link">&para;</a></h4> <p><div class="language-python highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1># These are equivalent:</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=n>LowercaseProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span> <span class=n>WhitespaceProjection</span><span class=p>()</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=n>WhitespaceProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span> <span class=n>LowercaseProjection</span><span class=p>()</span>
</span></code></pre></div> <strong>Reason:</strong> Case and whitespace are independent.</p> <h4 id=unicode-nfc-lowercase>Unicode NFC + Lowercase<a class=headerlink href=#unicode-nfc-lowercase title="Permanent link">&para;</a></h4> <p><div class="language-python highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1># These are equivalent:</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=n>UnicodeNormalizationProjection</span><span class=p>(</span><span class=s1>&#39;NFC&#39;</span><span class=p>)</span> <span class=o>&gt;&gt;</span> <span class=n>LowercaseProjection</span><span class=p>()</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=n>LowercaseProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span> <span class=n>UnicodeNormalizationProjection</span><span class=p>(</span><span class=s1>&#39;NFC&#39;</span><span class=p>)</span>
</span></code></pre></div> <strong>Reason:</strong> Both preserve semantic content, operate on different aspects.</p> <h3 id=43-non-commutative-examples>4.3 Non-Commutative Examples<a class=headerlink href=#43-non-commutative-examples title="Permanent link">&para;</a></h3> <h4 id=synonym-edit-distance>Synonym + Edit Distance<a class=headerlink href=#synonym-edit-distance title="Permanent link">&para;</a></h4> <p><strong>NOT commutative</strong> - see Section 1.1</p> <h4 id=truncation-anything>Truncation + Anything<a class=headerlink href=#truncation-anything title="Permanent link">&para;</a></h4> <p>Truncation is non-commutative with almost everything: <div class="language-python highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1># Different results:</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=n>RecencyProjection</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span> <span class=o>&gt;&gt;</span> <span class=n>LowercaseProjection</span><span class=p>()</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=n>LowercaseProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span> <span class=n>RecencyProjection</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></code></pre></div></p> <hr> <h2 id=5-practical-guidelines>5. Practical Guidelines<a class=headerlink href=#5-practical-guidelines title="Permanent link">&para;</a></h2> <h3 id=51-decision-tree-for-ordering>5.1 Decision Tree for Ordering<a class=headerlink href=#51-decision-tree-for-ordering title="Permanent link">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>Question 1: Does one projection lose information?
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>  YES → Apply information-preserving first
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>  NO → Continue
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>Question 2: Does one correct errors?
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>  YES → Apply error correction first
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>  NO → Continue
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>Question 3: Does one expand semantic space?
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>  YES → Apply semantic expansion before structural matching
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>  NO → Continue
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>Question 4: Are they independent?
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a>  YES → Order doesn&#39;t matter
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>  NO → Test both orders, choose better result
</span></code></pre></div> <h3 id=52-testing-for-commutativity>5.2 Testing for Commutativity<a class=headerlink href=#52-testing-for-commutativity title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=k>def</span><span class=w> </span><span class=nf>test_commutativity</span><span class=p>(</span><span class=n>proj1</span><span class=p>,</span> <span class=n>proj2</span><span class=p>,</span> <span class=n>test_cases</span><span class=p>):</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Test if two projections commute on given test cases.&quot;&quot;&quot;</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>    <span class=k>for</span> <span class=n>context</span><span class=p>,</span> <span class=n>corpus</span> <span class=ow>in</span> <span class=n>test_cases</span><span class=p>:</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>        <span class=n>result1</span> <span class=o>=</span> <span class=p>(</span><span class=n>proj1</span> <span class=o>&gt;&gt;</span> <span class=n>proj2</span><span class=p>)</span><span class=o>.</span><span class=n>project</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>corpus</span><span class=p>)</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>        <span class=n>result2</span> <span class=o>=</span> <span class=p>(</span><span class=n>proj2</span> <span class=o>&gt;&gt;</span> <span class=n>proj1</span><span class=p>)</span><span class=o>.</span><span class=n>project</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>corpus</span><span class=p>)</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>        <span class=k>if</span> <span class=n>result1</span> <span class=o>!=</span> <span class=n>result2</span><span class=p>:</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Non-commutative: </span><span class=si>{</span><span class=n>result1</span><span class=si>}</span><span class=s2> ≠ </span><span class=si>{</span><span class=n>result2</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>            <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a>    <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-12-12><a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a>
</span><span id=__span-12-13><a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=c1># Example usage</span>
</span><span id=__span-12-14><a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=n>test_cases</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-12-15><a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a>    <span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=s2>&quot;Hello  World&quot;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)),</span> <span class=p>[]),</span>
</span><span id=__span-12-16><a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a>    <span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=s2>&quot;the quik cat&quot;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)),</span> <span class=p>[]),</span>
</span><span id=__span-12-17><a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=p>]</span>
</span><span id=__span-12-18><a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a>
</span><span id=__span-12-19><a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a><span class=n>is_commutative</span> <span class=o>=</span> <span class=n>test_commutativity</span><span class=p>(</span>
</span><span id=__span-12-20><a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a>    <span class=n>LowercaseProjection</span><span class=p>(),</span>
</span><span id=__span-12-21><a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a>    <span class=n>WhitespaceProjection</span><span class=p>(),</span>
</span><span id=__span-12-22><a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a>    <span class=n>test_cases</span>
</span><span id=__span-12-23><a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a><span class=p>)</span>
</span></code></pre></div> <h3 id=53-documenting-ordering-constraints>5.3 Documenting Ordering Constraints<a class=headerlink href=#53-documenting-ordering-constraints title="Permanent link">&para;</a></h3> <p>Each projection should document its ordering preferences:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=k>class</span><span class=w> </span><span class=nc>SynonymProjection</span><span class=p>(</span><span class=n>Projection</span><span class=p>):</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=sd>    Synonym projection using WordNet.</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=sd>    Ordering constraints:</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=sd>    - AFTER: EditDistanceProjection (fix typos first)</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=sd>    - BEFORE: LongestSuffixProjection (expand before matching)</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=sd>    - COMMUTES WITH: LowercaseProjection, WhitespaceProjection</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=sd>    &quot;&quot;&quot;</span>
</span></code></pre></div> <hr> <h2 id=6-advanced-multi-path-projections>6. Advanced: Multi-Path Projections<a class=headerlink href=#6-advanced-multi-path-projections title="Permanent link">&para;</a></h2> <h3 id=61-exploring-multiple-orders>6.1 Exploring Multiple Orders<a class=headerlink href=#61-exploring-multiple-orders title="Permanent link">&para;</a></h3> <p>Instead of choosing one order, try multiple:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=k>class</span><span class=w> </span><span class=nc>MultiOrderProjection</span><span class=p>(</span><span class=n>Projection</span><span class=p>):</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Try multiple projection orders and return best match.&quot;&quot;&quot;</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>projections</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Projection</span><span class=p>]):</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>projections</span> <span class=o>=</span> <span class=n>projections</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>    <span class=k>def</span><span class=w> </span><span class=nf>project_multi</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>context</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>],</span> <span class=n>corpus</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Set</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=o>...</span><span class=p>]]:</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>        <span class=n>results</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a>        <span class=c1># Try all permutations of projection orderings</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a>        <span class=kn>from</span><span class=w> </span><span class=nn>itertools</span><span class=w> </span><span class=kn>import</span> <span class=n>permutations</span>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a>        <span class=k>for</span> <span class=n>order</span> <span class=ow>in</span> <span class=n>permutations</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>projections</span><span class=p>):</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a>            <span class=c1># Apply projections in this order</span>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a>            <span class=n>result</span> <span class=o>=</span> <span class=n>context</span>
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a>            <span class=k>for</span> <span class=n>proj</span> <span class=ow>in</span> <span class=n>order</span><span class=p>:</span>
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a>                <span class=n>result</span> <span class=o>=</span> <span class=n>proj</span><span class=o>.</span><span class=n>project</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>corpus</span><span class=p>)</span>
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a>            <span class=n>results</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=nb>tuple</span><span class=p>(</span><span class=n>result</span><span class=p>))</span>
</span><span id=__span-14-18><a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a>
</span><span id=__span-14-19><a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a>        <span class=k>return</span> <span class=n>results</span>
</span></code></pre></div> <p><strong>Use case:</strong> When optimal order is unclear, let the model try all.</p> <p><strong>Warning:</strong> Exponential complexity - only feasible for small numbers of projections.</p> <h3 id=62-learned-ordering>6.2 Learned Ordering<a class=headerlink href=#62-learned-ordering title="Permanent link">&para;</a></h3> <p>Train a model to select optimal projection order:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=k>class</span><span class=w> </span><span class=nc>LearnedOrderProjection</span><span class=p>(</span><span class=n>Projection</span><span class=p>):</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Learn optimal projection order based on context.&quot;&quot;&quot;</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>projections</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Projection</span><span class=p>],</span> <span class=n>order_model</span><span class=p>):</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>projections</span> <span class=o>=</span> <span class=n>projections</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>        <span class=bp>self</span><span class=o>.</span><span class=n>order_model</span> <span class=o>=</span> <span class=n>order_model</span>  <span class=c1># Neural network or decision tree</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a>    <span class=k>def</span><span class=w> </span><span class=nf>project</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>context</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>],</span> <span class=n>corpus</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]:</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a>        <span class=c1># Use learned model to predict best ordering</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a>        <span class=n>order</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>order_model</span><span class=o>.</span><span class=n>predict_order</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>corpus</span><span class=p>)</span>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a>        <span class=n>result</span> <span class=o>=</span> <span class=n>context</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a>        <span class=k>for</span> <span class=n>idx</span> <span class=ow>in</span> <span class=n>order</span><span class=p>:</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a>            <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>projections</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span><span class=o>.</span><span class=n>project</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=n>corpus</span><span class=p>)</span>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a>        <span class=k>return</span> <span class=n>result</span>
</span></code></pre></div> <hr> <h2 id=7-implications-for-api-design>7. Implications for API Design<a class=headerlink href=#7-implications-for-api-design title="Permanent link">&para;</a></h2> <h3 id=71-left-to-right-composition>7.1 Left-to-Right Composition<a class=headerlink href=#71-left-to-right-composition title="Permanent link">&para;</a></h3> <p>Use <code>&gt;&gt;</code> operator for clarity (matches text reading order):</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=c1># Clear intent: apply left-to-right</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=n>pipeline</span> <span class=o>=</span> <span class=p>(</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>    <span class=n>EditDistanceProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span>  <span class=c1># First</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>    <span class=n>LowercaseProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span>      <span class=c1># Second</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>    <span class=n>SynonymProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span>        <span class=c1># Third</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>    <span class=n>LongestSuffixProjection</span><span class=p>()</span>     <span class=c1># Last</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=p>)</span>
</span></code></pre></div> <p><strong>Rationale:</strong> Mathematical <span class=arithmatex>\(\circ\)</span> is right-to-left <span class=arithmatex>\((f \circ g)(x) = f(g(x))\)</span>, but programming pipelines read left-to-right.</p> <h3 id=72-named-pipelines>7.2 Named Pipelines<a class=headerlink href=#72-named-pipelines title="Permanent link">&para;</a></h3> <p>Provide pre-configured pipelines with documented ordering:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=k>class</span><span class=w> </span><span class=nc>StandardPipeline</span><span class=p>(</span><span class=n>Projection</span><span class=p>):</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=sd>    Standard projection pipeline.</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=sd>    Order:</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=sd>    1. Error correction (edit distance ≤ 1)</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=sd>    2. Normalization (lowercase, whitespace, Unicode NFC)</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=sd>    3. Truncation (last 100 tokens)</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a>        <span class=bp>self</span><span class=o>.</span><span class=n>pipeline</span> <span class=o>=</span> <span class=p>(</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a>            <span class=n>EditDistanceProjection</span><span class=p>(</span><span class=n>max_distance</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a>            <span class=n>WhitespaceProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a>            <span class=n>LowercaseProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a>            <span class=n>UnicodeNormalizationProjection</span><span class=p>(</span><span class=s1>&#39;NFC&#39;</span><span class=p>)</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a>            <span class=n>RecencyProjection</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
</span><span id=__span-17-18><a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a>        <span class=p>)</span>
</span><span id=__span-17-19><a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a>
</span><span id=__span-17-20><a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a>    <span class=k>def</span><span class=w> </span><span class=nf>project</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>context</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>],</span> <span class=n>corpus</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>]:</span>
</span><span id=__span-17-21><a id=__codelineno-17-21 name=__codelineno-17-21 href=#__codelineno-17-21></a>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>pipeline</span><span class=o>.</span><span class=n>project</span><span class=p>(</span><span class=n>context</span><span class=p>,</span> <span class=n>corpus</span><span class=p>)</span>
</span></code></pre></div> <h3 id=73-validation>7.3 Validation<a class=headerlink href=#73-validation title="Permanent link">&para;</a></h3> <p>Check for common ordering mistakes:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=k>def</span><span class=w> </span><span class=nf>validate_pipeline</span><span class=p>(</span><span class=n>pipeline</span><span class=p>:</span> <span class=n>Projection</span><span class=p>):</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Warn about potential ordering issues.&quot;&quot;&quot;</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a>    <span class=c1># Example: Warn if lossy operation comes before normalization</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>pipeline</span><span class=p>,</span> <span class=n>SequentialProjection</span><span class=p>):</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a>        <span class=n>first</span><span class=p>,</span> <span class=n>second</span> <span class=o>=</span> <span class=n>pipeline</span><span class=o>.</span><span class=n>first</span><span class=p>,</span> <span class=n>pipeline</span><span class=o>.</span><span class=n>second</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a>        <span class=k>if</span> <span class=n>is_lossy</span><span class=p>(</span><span class=n>first</span><span class=p>)</span> <span class=ow>and</span> <span class=n>is_normalizing</span><span class=p>(</span><span class=n>second</span><span class=p>):</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a>            <span class=n>warnings</span><span class=o>.</span><span class=n>warn</span><span class=p>(</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a>                <span class=sa>f</span><span class=s2>&quot;Lossy projection </span><span class=si>{</span><span class=n>first</span><span class=si>}</span><span class=s2> before normalizing </span><span class=si>{</span><span class=n>second</span><span class=si>}</span><span class=s2>. &quot;</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a>                <span class=sa>f</span><span class=s2>&quot;Consider reversing order.&quot;</span>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a>            <span class=p>)</span>
</span></code></pre></div> <hr> <h2 id=8-mathematical-properties>8. Mathematical Properties<a class=headerlink href=#8-mathematical-properties title="Permanent link">&para;</a></h2> <h3 id=81-associativity-preserved>8.1 Associativity (Preserved)<a class=headerlink href=#81-associativity-preserved title="Permanent link">&para;</a></h3> <p>Despite non-commutativity, projections are <strong>associative</strong>:</p> <div class=arithmatex>\[(\pi_1 \circ \pi_2) \circ \pi_3 = \pi_1 \circ (\pi_2 \circ \pi_3)\]</div> <p><strong>Proof:</strong> Both sides equal: <span class=arithmatex>\(\pi_1(\pi_2(\pi_3(x, C), C), C)\)</span></p> <p>This allows us to write unambiguous chains: <span class=arithmatex>\(<span class=arithmatex>\(\pi_1 \circ \pi_2 \circ \pi_3 \circ \pi_4\)</span>\)</span></p> <h3 id=82-identity-preservation>8.2 Identity Preservation<a class=headerlink href=#82-identity-preservation title="Permanent link">&para;</a></h3> <div class=arithmatex>\[\pi \circ \pi_{\text{id}} = \pi_{\text{id}} \circ \pi = \pi\]</div> <h3 id=83-partial-ordering>8.3 Partial Ordering<a class=headerlink href=#83-partial-ordering title="Permanent link">&para;</a></h3> <p>We can define a partial order on projections based on "should come before":</p> <div class=arithmatex>\[\pi_1 \prec \pi_2 \quad \text{if $\pi_1$ should be applied before $\pi_2$}\]</div> <p><strong>Properties:</strong> - <strong>Transitive:</strong> <span class=arithmatex>\(\pi_1 \prec \pi_2 \land \pi_2 \prec \pi_3 \implies \pi_1 \prec \pi_3\)</span> - <strong>Antisymmetric:</strong> <span class=arithmatex>\(\pi_1 \prec \pi_2 \land \pi_2 \prec \pi_1 \implies \pi_1 = \pi_2\)</span> - <strong>Partial:</strong> Not all pairs are comparable</p> <p><strong>Example Partial Order:</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a>EditDistance
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a>    ↓
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>Lowercase ← → Whitespace  (incomparable/commutative)
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>    ↓            ↓
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>    ↓←←←←←←←←←←←←
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>    ↓
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a>Synonym
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>    ↓
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a>LongestSuffix
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a>    ↓
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a>Recency
</span></code></pre></div></p> <hr> <h2 id=9-case-studies>9. Case Studies<a class=headerlink href=#9-case-studies title="Permanent link">&para;</a></h2> <h3 id=91-case-study-query-expansion-for-search>9.1 Case Study: Query Expansion for Search<a class=headerlink href=#91-case-study-query-expansion-for-search title="Permanent link">&para;</a></h3> <p><strong>Goal:</strong> Find documents matching user query, accounting for typos and synonyms.</p> <p><strong>Naive Pipeline (Wrong):</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1># WRONG: Synonym first might miss typos</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=n>SynonymProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span> <span class=n>EditDistanceProjection</span><span class=p>()</span>
</span></code></pre></div></p> <p><strong>Correct Pipeline:</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=c1># RIGHT: Fix typos, then expand synonyms</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=n>EditDistanceProjection</span><span class=p>(</span><span class=n>max_distance</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=n>LowercaseProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=n>SynonymProjection</span><span class=p>(</span><span class=n>max_synsets</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=n>LongestSuffixProjection</span><span class=p>()</span>
</span></code></pre></div></p> <p><strong>Rationale:</strong> 1. Fix typos first (can't find synonyms of misspellings) 2. Normalize case (consistent matching) 3. Expand to synonyms (increase recall) 4. Find longest match in corpus (best result)</p> <h3 id=92-case-study-code-completion>9.2 Case Study: Code Completion<a class=headerlink href=#92-case-study-code-completion title="Permanent link">&para;</a></h3> <p><strong>Goal:</strong> Suggest code completions from codebase.</p> <p><strong>Pipeline:</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1># 1. Normalize whitespace (code formatting varies)</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=n>WhitespaceProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=c1># 2. Keep recent tokens only (local context matters in code)</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=n>RecencyProjection</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>50</span><span class=p>)</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=c1># 3. Find longest matching suffix (exact match preferred)</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=n>LongestSuffixProjection</span><span class=p>(</span><span class=n>min_length</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=c1># Note: No case normalization (code is case-sensitive)</span>
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=c1># Note: No synonym expansion (code tokens are literal)</span>
</span></code></pre></div></p> <p><strong>Rationale:</strong> Code is more literal than natural language, so fewer semantic transformations needed.</p> <h3 id=93-case-study-chat-message-matching>9.3 Case Study: Chat Message Matching<a class=headerlink href=#93-case-study-chat-message-matching title="Permanent link">&para;</a></h3> <p><strong>Goal:</strong> Find similar previous chat messages.</p> <p><strong>Pipeline:</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1># 1. Aggressive normalization (chat has inconsistent formatting)</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=n>WhitespaceProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=n>LowercaseProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=n>PunctuationRemovalProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=c1># 2. Expand with common chat abbreviations</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=n>ChatAbbreviationExpansion</span><span class=p>()</span> <span class=o>&gt;&gt;</span>  <span class=c1># lol → laughing out loud, etc.</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=c1># 3. Emoji normalization</span>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=n>EmojiNormalizationProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a>
</span><span id=__span-23-12><a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=c1># 4. Find similar message</span>
</span><span id=__span-23-13><a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=n>EditDistanceProjection</span><span class=p>(</span><span class=n>max_distance</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></code></pre></div></p> <p><strong>Rationale:</strong> Chat messages are informal and vary widely in style, need aggressive normalization.</p> <hr> <h2 id=10-conclusion>10. Conclusion<a class=headerlink href=#10-conclusion title="Permanent link">&para;</a></h2> <h3 id=101-key-takeaways>10.1 Key Takeaways<a class=headerlink href=#101-key-takeaways title="Permanent link">&para;</a></h3> <ol> <li><strong>Projections are non-commutative</strong> - order matters</li> <li><strong>Follow ordering principles:</strong></li> <li>Error correction first</li> <li>Normalization before expansion</li> <li>Semantic before structural</li> <li>Lossy operations last</li> <li><strong>Test commutativity</strong> when unsure</li> <li><strong>Document ordering constraints</strong> in projection classes</li> <li><strong>Use left-to-right (<code>&gt;&gt;</code>)</strong> for readability</li> </ol> <h3 id=102-default-pipeline-recommendation>10.2 Default Pipeline Recommendation<a class=headerlink href=#102-default-pipeline-recommendation title="Permanent link">&para;</a></h3> <p>For general text matching:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=n>StandardTextProjection</span> <span class=o>=</span> <span class=p>(</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>    <span class=n>EditDistanceProjection</span><span class=p>(</span><span class=n>max_distance</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=o>&gt;&gt;</span>  <span class=c1># Fix typos</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>    <span class=n>WhitespaceProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span>                  <span class=c1># Normalize whitespace</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>    <span class=n>LowercaseProjection</span><span class=p>()</span> <span class=o>&gt;&gt;</span>                   <span class=c1># Case-insensitive</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>    <span class=n>UnicodeNormalizationProjection</span><span class=p>(</span><span class=s1>&#39;NFC&#39;</span><span class=p>)</span> <span class=o>&gt;&gt;</span>   <span class=c1># Unicode consistency</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>    <span class=n>RecencyProjection</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>          <span class=c1># Keep recent context</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=p>)</span>
</span></code></pre></div> <h3 id=103-future-work>10.3 Future Work<a class=headerlink href=#103-future-work title="Permanent link">&para;</a></h3> <ul> <li><strong>Automatic ordering:</strong> Learn optimal projection order from data</li> <li><strong>Conditional projections:</strong> Apply different projections based on context type</li> <li><strong>Adaptive ordering:</strong> Reorder based on corpus statistics</li> <li><strong>Parallel exploration:</strong> Try multiple orders and ensemble results</li> </ul> <p>This framework provides principled guidance for ordering projections while acknowledging the inherent non-commutativity of the composition operation.</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 LangCalc Project </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/queelius/langcalc target=_blank rel=noopener title="GitHub Repository" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "toc.follow", "toc.integrate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.f55a23d4.min.js></script> <script src=../../javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>